---
layout: post
title: "C#实现简单的程序日志输出"
date: 2020-04-07 00:00
comments: true
toc: true
tags:
  - 2020-04
  - C#
  - 日志输出
  - 教程
---

程序调试的时候好好的，发布之后老是出问题，原因还找不到？那得好好考虑将异常报错信息输出到日志文件了！
话不多说，直接上代码 ↓↓↓

<!--more-->

``` csharp
using System;
using System.IO;

namespace [命名空间]
{
    public class LogHelper
    {
        //定义日志输出位置
        private readonly static string rootDir = Environment.CurrentDirectory.ToString() + "\\SystemLogs";

        /// <summary>
        /// 输出自定义日志
        /// </summary>
        /// <param name="msg"></param>
        public static void WriteLog(string msg)
        {
            var logDir = rootDir + $"\\{DateTime.Now:yyyyMM}";
            if (!Directory.Exists(logDir))
                Directory.CreateDirectory(logDir);
            string filePath = logDir + $"\\syslog_{DateTime.Now:yyyyMMdd}.log";
            StreamWriter tw = null;
            try
            {
                if (!File.Exists(filePath))
                {
                    File.Create(filePath).Close();
                }
                using (tw = File.AppendText(filePath))
                {
#if DEBUG 
                    tw.WriteLine($"【{DateTime.Now:yyyy/MM/dd HH:mm:ss}】 (Debug) >> {msg}");
#else
                    tw.WriteLine($"【{DateTime.Now:yyyy/MM/dd HH:mm:ss}】 >> " + msg);
#endif

                    tw.Flush();
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
            finally
            {
                if (tw != null)
                    tw.Close();
            }
        }

        /// <summary>
        /// 输出异常信息
        /// </summary>
        /// <param name="exMsg">异常信息</param>
        public static void WriteLog(Exception exMsg)
        {
            var logDir = rootDir + $"\\{DateTime.Now:yyyyMM}";
            if (!Directory.Exists(logDir))
                Directory.CreateDirectory(logDir);
            string filePath = logDir + $"\\syslog_{DateTime.Now:yyyyMMdd}.log";
            StreamWriter tw = null;
            try
            {
                if (!File.Exists(filePath))
                {
                    File.Create(filePath).Close();
                }
                using (tw = File.AppendText(filePath))
                {
#if DEBUG
                    tw.WriteLine($"【{DateTime.Now:yyyy/MM/dd HH:mm:ss}】 (Debug) >> {exMsg.Message}\n{exMsg.InnerException}");
#else
                    tw.WriteLine($"【{DateTime.Now:yyyy/MM/dd HH:mm:ss}】 >> " + msg);
#endif

                    tw.Flush();
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
            finally
            {
                if (tw != null)
                    tw.Close();
            }
        }
    }
}
```

其中「#if DEBUG"」用于标志调试模式输出的日志。

整个方法逻辑很简单，就是将需要输出的日志或者异常信息按照自己定义的格式追加到指定的文件中。