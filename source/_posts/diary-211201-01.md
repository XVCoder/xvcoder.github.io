---
layout: post
title: "Linux下离线安装docker及docker-compose"
date: 2021-12-01 00:00
comments: true
toc: true
tags:
  - 2021-12
  - Linux
  - Docker
  - Docker-Compose
  - 教程
---

本教程介绍在Linux下离线安装docker及docker-compose。

<!--more-->

---

### 【Linux下离线安装docker】

#### 1、准备docker离线包
> 下载地址：https://download.docker.com/linux/static/stable/x86_64/

#### 2、准备docker.service文件，内容如下
``` bash
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target firewalld.service
Wants=network-online.target

[Service]
Type=notify
# the default is not to use systemd for cgroups because the delegate issues still
# exists and systemd currently does not support the cgroup feature set required
# for containers run by docker
ExecStart=/usr/bin/dockerd
ExecReload=/bin/kill -s HUP $MAINPID
# Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
# Uncomment TasksMax if your systemd version supports it.
# Only systemd 226 and above support this version.
#TasksMax=infinity
TimeoutStartSec=0
# set delegate yes so that systemd does not reset the cgroups of docker containers
Delegate=yes
# kill only the docker process, not all processes in the cgroup
KillMode=process
# restart the docker process if it exits prematurely
Restart=on-failure
StartLimitBurst=3
StartLimitInterval=60s

[Install]
WantedBy=multi-user.target
```

#### 3、准备安装脚本（install.sh），内容如下：
``` bash
#!/bin/sh
echo '解压tar包...'
tar -xvf $1
echo '将docker目录移到/usr/bin目录下...'
cp docker/* /usr/bin/
echo '将docker.service 移到/etc/systemd/system/ 目录...'
cp docker.service /etc/systemd/system/
echo '添加文件权限...'
chmod +x /etc/systemd/system/docker.service
echo '重新加载配置文件...'
systemctl daemon-reload
echo '启动docker...'
systemctl start docker
echo '设置开机自启...'
systemctl enable docker.service
echo 'docker安装成功...'
docker -v
```

#### 4、准备卸载脚本（uninstall.sh），内容如下：

``` bash
#!/bin/sh
echo '删除docker.service...'
rm -f /etc/systemd/system/docker.service
echo '删除docker文件...'
rm -rf /usr/bin/docker*
echo '重新加载配置文件'
systemctl daemon-reload
echo '卸载成功...'
```

#### 5、安装
``` bash
# 将tgz文件、docker.service、install.sh、uninstall.sh放到同一个目录

# 给脚本赋予可执行权限
chmod +x *.sh
```

#### 6、执行安装脚本进行
``` bash
./install.sh docker-***.tgz
```

#### 7、验证
``` bash
docker -v
```

#### 8、卸载
``` bash
# 直接执行 uninstall.sh 即可
./uninstall.sh
```

> 参考:  
https://www.jb51.net/article/167103.htm

---

### 【将当前用户加入docker组】

#### 1、新建一个docker组，如果已存在则不需要新建
``` bash
sudo groupadd docker
```

查看已存在的组

``` bash
cat /etc/group
```

#### 2、将当前用户加入docker组
``` bash
sudo gpasswd -a ${USER} docker
```

#### 3、重启docker
``` bash
sudo systemctl restart docker
```

#### 4、切换当前会话到新的group
``` bash
newgrp - docker
```

---

【Linux下离线安装docker-compose】

#### 1、到docker-compose的GitHub发布页面下载对应版本的docker-compose（二进制文件）
    下载地址：https://github.com/docker/compose/releases

#### 2、将可执行重命名为 docker-compose

#### 3、将可执行文件移动到指定目录
``` bash
sudo mv docker-compose /usr/local/bin
```

#### 4、赋予可执行权限
``` bash
sudo chmod +x /usr/local/bin/docker-compose
```

#### 5、创建软链接
``` bash
sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
```

#### 6、测试安装是否成功
``` bash
docker-compose --version
```

注意：
对于alpine需要以下依赖包： py-pip，python-dev，libffi-dev，openssl-dev，gcc，libc-dev，和 make



> 参考:  
https://blog.csdn.net/qq_22041375/article/details/106922563